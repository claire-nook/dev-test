<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <title>Markdown é è¦½</title>
        <!-- å˜—è©¦è¼‰å…¥ markedï¼›è‹¥å¤±æ•—æ”¹ç”¨å…§å»º fallback -->
        <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
        <!-- å˜—è©¦è¼‰å…¥ mermaidåœ–è¡¨æ”¯æ´ -->
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
        <!-- ä¸»é¡Œè‰²ç³»çµ±ä¸€æ”¾åœ¨é€™è£¡ -->
        <style id="themes-css">
            /* åŸé¢¨æ ¼ï¼šè¡¨é ­åº•è‰² */
            :root {
                --bg: #f6f7fb;
                --panel: #ffffff;
                --line: #e5e7eb;
                --text: #111827;
                --muted: #6b7280;
                --btn: #111827;
                --btn-hover: #000000;
                --link: #2563eb;

                --bq-border: #d1d5db;
                --bq-bg: #f9fafb;
                --bq-quote: rgba(17, 24, 39, 0.12);
                --bq-text-muted: #6b7280;

                --thumb-w: 320px;
                --thumb-h: 200px;

                --table-head-bg: #f8fafc;
            }
            /* å¥¶èŒ¶ç³» */
            :root[data-theme="milktea"] {
                --bg: #fdfaf6; /* æ·¡å¥¶æ²¹ç±³è‰² */
                --panel: #ffffff; /* ç´”ç™½è¥¯æ‰˜ */
                --line: #e2c9b7; /* å¥¶èŒ¶é‚Šæ¡†è‰² */
                --text: #4b3621; /* æ·±å’–å•¡å­—è‰² */
                --muted: #7a5f4b; /* æ¬¡è¦æ–‡å­—ï¼šç„¦ç³–è‰² */
                --btn: #d7a86e; /* å¥¶èŒ¶æ‹¿éµè‰²æŒ‰éˆ• */
                --btn-hover: #c08552; /* ç„¦ç³– hover */
                --bq-border: #e6d0c1; /* å¥¶æ²¹ç±³é‚Šæ¡† */
                --bq-bg: #f9f3ef; /* å¼•ç”¨èƒŒæ™¯ï¼šæ·¡æ‹¿éµ */
                --bq-quote: rgba(160, 115, 85, 0.2);
                --bq-text-muted: #7a5f4b;
                --link: #a47148; /* å¯å¯é€£çµè‰² */
                --table-head-bg: #f3e7df; /* æŸ”å’Œç±³ç° */
            }

            /* æ£®æ—ç³» */
            :root[data-theme="forest"] {
                --bg: #ffffff; /* ç™½åº•ï¼Œä¹¾æ·¨ */
                --panel: #ffffff; /* é¢æ¿ç™½ */
                --line: #cfd8d3; /* æ·¡ç°ç¶ é‚Šç·š */
                --text: #1b2d1b; /* æ·±å¢¨ç¶ å­—é«”ï¼Œç©©é‡ */
                --muted: #4a5d4a; /* æ¬¡è¦å­—è‰²ï¼šæš—è‹”ç¶  */

                --btn: #3b6b3b; /* ä¸»æŒ‰éˆ•ï¼šæ£®æ—ç¶  */
                --btn-hover: #2f4f2f; /* hoverï¼šæ›´æš—ä¸€éšçš„ç¶  */
                --link: #2e6f4f; /* æ·±è—ç¶ é€£çµ */

                --bq-border: #7a8f7a; /* å¼•ç”¨é‚Šæ¡†ï¼šç°ç¶  */
                --bq-bg: #f4f7f4; /* å¼•ç”¨èƒŒæ™¯ï¼šå¾ˆæ·ºçš„ç°ç¶  */
                --bq-quote: rgba(59, 107, 59, 0.2); /* å¼•ç”¨è£é£¾ */
                --bq-text-muted: #4a5d4a;

                --table-head-bg: #e9f0eb; /* è¡¨é ­ï¼šæ·¡ç°ç¶  */
            }
            /* ç©©é‡è—ç³» */
            :root[data-theme="navy"] {
                --bg: #f8fafc; /* æ·¡éœ§è—ç°èƒŒæ™¯ */
                --panel: #ffffff; /* ç™½è‰²é¢æ¿ */
                --line: #cbd5e1; /* æ·¡ç°è—é‚Šç·š */
                --text: #1e293b; /* æ·±è—ç°å­—é«”ï¼Œæ²‰ç©© */
                --muted: #475569; /* æ¬¡è¦å­—è‰²ï¼šçŸ³æ¿è—ç° */
                --btn: #3b82f6; /* ä¸»æŒ‰éˆ•ï¼šäº®è— */
                --btn-hover: #1d4ed8; /* hoverï¼šæ·±è— */
                --bq-border: #93c5fd; /* å¼•ç”¨æ¡†é‚Šï¼šæ·¡è— */
                --bq-bg: #eff6ff; /* å¼•ç”¨èƒŒæ™¯ï¼šæ·ºè—éœ§ */
                --bq-quote: rgba(59, 130, 246, 0.15);
                --bq-text-muted: #475569;
                --link: #2563eb; /* è—è‰²é€£çµ */
                --table-head-bg: #e0f2fe; /* è¡¨é ­ï¼šæ·ºæ¹–è— */
            }
            /* ç²‰ç´…ç»ç‘°ç³» */
            :root[data-theme="rose"] {
                --bg: #fff7fa; /* æ·ºç²‰èƒŒæ™¯ */
                --panel: #ffffff;
                --line: #f7cad0; /* ç²‰é‚Šæ¡† */
                --text: #5a2a36; /* é…’ç´…å­—é«”ï¼Œç©©é‡ */
                --muted: #915c6c; /* ç²‰æ£•æ¬¡è¦å­—è‰² */
                --btn: #e66b8c; /* ç«ç‘°ç²‰æŒ‰éˆ• */
                --btn-hover: #d13f66; /* æ·±æ«» hover */
                --bq-border: #f9b5c3; /* å¼•ç”¨é‚Šæ¡†ï¼šæ·ºç«ç‘° */
                --bq-bg: #fff0f5; /* å¼•ç”¨èƒŒæ™¯ï¼šèœœæ¡ƒç²‰ */
                --bq-quote: rgba(230, 107, 140, 0.2);
                --bq-text-muted: #915c6c;
                --link: #c63c67; /* ç«ç‘°ç´…é€£çµ */
                --table-head-bg: #fbe4eb;
            }

            /* ç²‰å«©æ©˜é»ƒç³» */
            :root[data-theme="peach"] {
                --bg: #fffaf5;
                --panel: #ffffff;
                --line: #ffd9b5;
                --text: #6b3a22;
                --muted: #8c5a3f;
                --btn: #ff8b3d;
                --btn-hover: #f97316;
                --bq-border: #ffcc99;
                --bq-bg: #fff1e6;
                --bq-quote: rgba(247, 127, 0, 0.15);
                --bq-text-muted: #8c5a3f;
                --link: #d97706;
                --table-head-bg: #fff1e6;
            }
            /* é’è˜‹æœç³» */
            :root[data-theme="apple"] {
                --bg: #f8fff5;
                --panel: #ffffff;
                --line: #c6f6d5;
                --text: #1a3c1a;
                --muted: #4a6f4a;
                --btn: #34d399;
                --btn-hover: #059669;
                --bq-border: #bbf7d0;
                --bq-bg: #ecfdf5;
                --bq-quote: rgba(16, 185, 129, 0.15);
                --bq-text-muted: #2f6d54;
                --link: #047857;
                --table-head-bg: #d1fae5;
            }
            /* æ¸…æ–°è—ç¶ ç³» */
            :root[data-theme="mint"] {
                --bg: #f0fffd;
                --panel: #ffffff;
                --line: #a7f3d0;
                --text: #0f5132;
                --muted: #1f6f54;
                --btn: #10b981;
                --btn-hover: #059669;
                --bq-border: #99f6e4;
                --bq-bg: #ecfeff;
                --bq-quote: rgba(13, 148, 136, 0.15);
                --bq-text-muted: #1f6f54;
                --link: #0ea5e9;
                --table-head-bg: #ecfeff;
            }
            /* è¦å†åŠ å…¶ä»–ä¸»é¡Œï¼Œå°±åœ¨é€™è£¡ç¹¼çºŒå¾€ä¸‹è²¼ */
        </style>
        <!-- å…¶ä»–çš„CSSçµ±ä¸€æ”¾åœ¨é€™è£¡ -->
        <style>
            html,
            body {
                height: 100%;
            }
            body {
                margin: 0;
                font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Noto Sans TC", "Noto Sans", "Hiragino Sans", "PingFang TC", "Microsoft JhengHei", Arial, Helvetica, sans-serif;
                color: var(--text);
                background: var(--bg);
                display: flex;
                flex-direction: column;
            }

            header {
                position: fixed;
                inset: 0 0 auto 0;
                z-index: 1000;
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 12px 16px;
                background: #fff;
                border-bottom: 1px solid var(--line);
                gap: 12px;
            }
            header .title {
                font-weight: 700;
                letter-spacing: 0.5px;
            }
            header .actions {
                display: flex;
                gap: 8px;
                align-items: center;
                flex-wrap: wrap;
            }
            .theme-wrap {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                font-size: 14px;
                color: var(--muted);
                border: 1px solid var(--line);
                border-radius: 8px;
                padding: 6px 10px;
                background: #fff;
            }
            select#themeSelect {
                border: 0;
                outline: none;
                background: transparent;
                font-size: 14px;
                color: var(--text);
                padding: 2px 4px;
                cursor: pointer;
            }

            .btn {
                appearance: none;
                border: 1px solid var(--line);
                background: var(--btn);
                color: #fff;
                padding: 6px 12px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 14px;
                line-height: 1;
                white-space: nowrap;
            }
            .btn.secondary {
                background: #fff;
                color: var(--text);
            }
            .btn:hover {
                background: var(--btn-hover);
            }
            .btn.secondary:hover {
                background: #f3f4f6;
            }

            .wrap {
                flex: 1;
                padding: 16px;
                box-sizing: border-box;
                margin-top: var(--header-h, 60px);
            }
            .panel {
                background: var(--panel);
                border: 1px solid var(--line);
                border-radius: 12px;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                min-height: 0;
            }
            .panel h3 {
                margin: 0;
                padding: 12px 14px;
                border-bottom: 1px solid var(--line);
                font-size: 14px;
                color: var(--muted);
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 6px;
            }
            .panel .body {
                padding: 16px;
                overflow: hidden;
                min-height: 0;
                flex: 1;
                background: #fff;
            }
            #preview {
                max-height: 100%;
                overflow: auto;
            }

            textarea {
                width: 100%;
                height: 100%;
                border: 0;
                outline: none;
                resize: none;
                font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
                font-size: 14px;
                line-height: 1.6;
            }

            /* é è¦½æ¨£å¼ */
            .preview-box {
                max-width: 100%;
                margin: 0 auto;
                color: var(--text);
            }
            .preview-box h1 {
                font-size: 1.75rem;
                margin: 0.2rem 0 1rem;
            }
            .preview-box h2 {
                font-size: 1.35rem;
                margin: 1.25rem 0 0.75rem;
            }
            .preview-box h3 {
                font-size: 1.1rem;
                margin: 1rem 0 0.5rem;
            }
            .preview-box p {
                margin: 0.5rem 0;
            }
            .preview-box code {
                background: #f3f4f6;
                padding: 0 0.35rem;
                border-radius: 4px;
                font-size: 0.95em;
            }
            .preview-box pre {
                background: #f3f4f6;
                padding: 12px;
                border-radius: 8px;
                overflow: auto;
                border: 1px solid var(--line);
            }
            .preview-box a {
                color: var(--link);
                text-decoration: none;
            }
            .preview-box a:hover {
                text-decoration: underline;
            }

            /* è¡¨æ ¼ */
            .preview-box table {
                width: 100%;
                border-collapse: collapse;
                margin: 1rem 0;
                font-size: 0.95rem;
            }
            .preview-box th,
            .preview-box td {
                border: 1px solid var(--line);
                padding: 0.6rem 0.75rem;
                vertical-align: top;
                text-align: left;
            }
            .preview-box thead th {
                background: var(--table-head-bg);
                font-weight: 700;
            }

            /* å¼•è¨€èˆ‡ callout */
            blockquote {
                position: relative;
                margin: 1rem 0;
                padding: 12px 16px 12px 18px;
                border-left: 4px solid var(--bq-border);
                background: var(--bq-bg);
                border-radius: 8px;
            }
            blockquote p {
                margin: 0.5rem 0;
            }
            blockquote cite,
            blockquote .attribution {
                display: block;
                margin-top: 0.5em;
                color: var(--bq-text-muted);
                font-style: italic;
                font-size: 0.95em;
            }
            blockquote::before {
                content: "â€œ";
                position: absolute;
                top: -6px;
                left: 8px;
                font-size: 40px;
                line-height: 1;
                color: var(--bq-quote);
                pointer-events: none;
            }
            blockquote blockquote {
                margin: 0.75rem 0 0.25rem 8px;
                border-left-color: color-mix(in srgb, var(--bq-border) 60%, white);
                background: color-mix(in srgb, var(--bq-bg) 70%, white);
            }
            blockquote {
                white-space: pre-wrap; /* ä¿ç•™æ›è¡Œ + è‡ªå‹•æ›è¡Œ */
                word-wrap: break-word; /* é•·å­—æ–·è¡Œ */
                overflow-wrap: break-word; /* æ–°æ¨™æº–å¯«æ³•ï¼Œç¢ºä¿é•·å­—æ–·è¡Œ */
            }

            .callout {
                padding: 0;
                border-left: 4px solid var(--bq-border);
                border-radius: 8px;
                background: var(--bq-bg);
                margin: 1rem 0;
            }
            .callout > .callout-head {
                display: flex;
                align-items: center;
                gap: 8px;
                padding: 10px 12px;
                font-weight: 700;
                border-bottom: 1px solid var(--bq-border);
            }
            .callout > .callout-body {
                padding: 12px 14px;
            }

            /* åœ–ç‰‡å€å¡Š */
            .gallery-block {
                border: 1px solid var(--line);
                border-radius: 12px;
                padding: 12px;
                background: #fff;
                margin: 1rem 0;
                box-shadow: 0 1px 0 rgba(0, 0, 0, 0.02);
            }
            .gallery-head {
                font-size: 13px;
                color: var(--muted);
                font-weight: 600;
                display: flex;
                align-items: center;
                gap: 6px;
                margin-bottom: 10px;
            }
            .gallery-head::before {
                content: "ğŸ–¼ï¸";
            }
            .gallery-grid {
                display: grid;
                grid-template-columns: repeat(3, var(--thumb-w)); /* åœ–ç‰‡å€å¡Šä¸€è¡Œé¡¯ç¤ºå¹¾å¼µ, è‹¥æœ‰èª¿æ•´è¦è¨˜å¾—åŒæ™‚æ”¹åŒ¯å‡ºhtmlçš„css */
                gap: 12px;
                justify-content: start;
            }
            .gallery-item {
                width: var(--thumb-w);
                height: var(--thumb-h);
                border: 1px solid var(--line);
                border-radius: 10px;
                overflow: hidden;
                background: #fff;
            }
            .gallery-link {
                display: block;
                width: 100%;
                height: 100%;
            }
            .gallery-item img.thumb {
                width: 100%;
                height: 100%;
                object-fit: cover;
                display: block;
            }
            .gallery-item .caption {
                padding: 6px 8px;
                font-size: 12px;
                color: var(--muted);
                border-top: 1px solid var(--line);
                background: #fafafa;
                display: none;
            }

            /* Lightbox */
            .lightbox {
                position: fixed;
                inset: 0;
                background: rgba(0, 0, 0, 0.8);
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 2000;
            }
            .lightbox.show {
                display: flex;
            }
            .lightbox img {
                max-width: 95vw;
                max-height: 90vh;
                border-radius: 8px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.35);
            }
            .lightbox .lb-close {
                position: absolute;
                top: 16px;
                right: 16px;
                background: rgba(255, 255, 255, 0.9);
                border: 0;
                padding: 8px 10px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: 700;
            }

            /* æç¤º */
            .toast {
                position: fixed;
                bottom: 16px;
                right: 16px;
                background: #111827;
                color: #fff;
                padding: 10px 14px;
                border-radius: 10px;
                font-size: 13px;
                opacity: 0;
                transform: translateY(10px);
                transition: opacity 0.2s, transform 0.2s;
                pointer-events: none;
                z-index: 2100;
            }
            .toast.show {
                opacity: 1;
                transform: translateY(0);
            }

            /* RWD */
            @media (max-width: 980px) {
                .wrap {
                    grid-template-columns: 1fr;
                }
            }
            @media (max-width: 767px) {
                header {
                    flex-wrap: wrap;
                    row-gap: 8px;
                }
                header .title {
                    flex: 1 0 100%;
                }
                header .actions {
                    width: 100%;
                    overflow-x: auto;
                    white-space: nowrap;
                    padding-bottom: 4px;
                }
                .wrap {
                    grid-template-columns: 1fr;
                }
                :root {
                    --thumb-w: 100%;
                    --thumb-h: 220px;
                }
                .gallery-grid {
                    grid-template-columns: 1fr;
                }
                #markdown-input {
                    min-height: 25vh;
                }
            }

            /* å¤–å±¤ç”¨ Grid æ§ä¸‰ç¨®å¯¬åº¦ */
            #workbench {
                display: grid;
                grid-template-columns: 1fr 1fr; /* split é è¨­å…©æ¬„ */
                gap: 0;
                height: calc(100vh - 120px); /* è‡ªè¡Œèª¿æ•´ï¼Œæ‰£æ‰ä½ çš„å·¥å…·åˆ—é«˜åº¦ */
            }

            /* ä¸‰ç¨®æ¨¡å¼ï¼šä¸¦æ’ / åªå·¦ / åªå³ */
            #workbench[data-layout="split"] {
                grid-template-columns: 1fr 1fr;
            }
            #workbench[data-layout="left"] {
                grid-template-columns: 1fr 0;
            }
            #workbench[data-layout="right"] {
                grid-template-columns: 0 1fr;
            }

            /* è¢«æ”¶èµ·çš„é‚£æ¬„å®Œå…¨ä¸å¯é»ã€ä¹Ÿä¸ä½”å¯è¦– */
            #workbench[data-layout="left"] #previewPane,
            #workbench[data-layout="right"] #editorPane {
                visibility: hidden;
                pointer-events: none;
                overflow: hidden;
            }

            /* å·¥å…·åˆ—ä¸‰éµçš„é¸ä¸­æ…‹ï¼Œåˆ¥åš hoverï¼Œå¹³æ¿ä¸éœ€è¦ */
            .view-toggle button[aria-pressed="true"] {
                font-weight: 700;
                border: 1px solid var(--line);
                background: #fff;
            }
            .view-toggle button {
                padding: 6px 10px;
                border: 1px solid var(--line);
                background: var(--panel);
                border-radius: 6px;
                margin-right: 6px;
            }
            #workbench {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 16px; /* â†åŠ é€™å€‹ï¼Œå·¦å³ä¸­é–“å°±ä¸æœƒé åˆ°é™°é™½å…©éš” */
                height: calc(100vh - 120px);
            }
            #workbench[data-layout="left"],
            #workbench[data-layout="right"] {
                gap: 0;
            }

            /* === Mobile split ä¿®æ­£ï¼šçµ¦å®¹å™¨é«˜åº¦ + æ˜ç¢ºå…©åˆ—æ¯”ä¾‹ === */
            @media (max-width: 768px) {
                /* å…±ç”¨ï¼šä¸€æ¬„ä¸Šä¸‹å †ç–Š + å›ºå®šå¯åˆ†é…çš„å®¹å™¨é«˜åº¦ */
                #workbench {
                    grid-template-columns: 1fr;
                    gap: 12px;
                    /* æ‰£æ‰è¡¨é ­èˆ‡å¤–é‚Šè·ï¼Œè®“ fr æœ‰ä¾æ“šå¯åˆ†é… */
                    height: calc(100vh - var(--header-h, 60px) - 24px);
                }

                /* ä¸¦æ’ï¼šä¸Š 40% ç·¨è¼¯ï¼Œä¸‹ 60% é è¦½ï¼ˆæˆ–æ”¹æˆ 40vh/1fr ä¹Ÿè¡Œï¼‰ */
                #workbench[data-layout="split"] {
                    grid-template-rows: 0.4fr 0.6fr;
                }
                /* è®“ grid åˆ—æ±ºå®šé«˜åº¦ï¼Œä¸ç”¨å†é– min-height */
                #workbench[data-layout="split"] #editorPane,
                #workbench[data-layout="split"] #previewPane {
                    min-height: 0;
                    height: auto;
                }

                /* åªå·¦ï¼šæ»¿é«˜ï¼›åªå³ï¼šæ»¿é«˜ï¼ˆç¶­æŒä½ å…ˆå‰çš„è¡Œç‚ºï¼‰ */
                #workbench[data-layout="left"] {
                    grid-template-rows: 1fr 0;
                }
                #workbench[data-layout="left"] #editorPane {
                    min-height: calc(100vh - var(--header-h, 60px) - 24px);
                }
                #workbench[data-layout="left"] #previewPane {
                    display: none;
                }

                #workbench[data-layout="right"] {
                    grid-template-rows: 0 1fr;
                }
                #workbench[data-layout="right"] #previewPane {
                    min-height: calc(100vh - var(--header-h, 60px) - 24px);
                }
                #workbench[data-layout="right"] #editorPane {
                    display: none;
                }
            }

            /* === Mobile layout: å¼·åˆ¶æŠŠ split æ”¹æˆä¸Šä¸‹ 40/60ï¼Œé¿å…æ¡Œé¢å…©æ¬„åƒé€²ä¾† === */
            @media (max-width: 768px) {
                /* å…±åŒï¼šä¸€æ¬„ï¼Œè®“åˆ—ä¾†æ§é«˜ */
                #workbench {
                    grid-template-columns: 1fr;
                    height: calc(100vh - var(--header-h, 60px) - 24px);
                    gap: 12px;
                }

                /* ä¸¦æ’ï¼šä¸€å®šè¦ç”¨ç›¸åŒæ¬Šé‡è¦†è“‹ columnsï¼Œå¦å‰‡æœƒè¢« #workbench[data-layout="split"] å£“é */
                #workbench[data-layout="split"] {
                    grid-template-columns: 1fr; /* â† é€™è¡Œæ˜¯é—œéµ */
                    grid-template-rows: 0.4fr 0.6fr; /* ä¸Š 40% ç·¨è¼¯ï¼Œä¸‹ 60% é è¦½ */
                }
                #workbench[data-layout="split"] #editorPane,
                #workbench[data-layout="split"] #previewPane {
                    min-height: 0; /* äº¤çµ¦ grid-row åˆ†é…é«˜åº¦ï¼Œä¸è¦è®“ min-height æ—äº‚ */
                    height: auto;
                }

                /* åªç·¨è¼¯ï¼šæ»¿é«˜ï¼Œé è¦½ä¸ä½”ç‰ˆé¢ */
                #workbench[data-layout="left"] {
                    grid-template-columns: 1fr;
                    grid-template-rows: 1fr 0;
                }
                #workbench[data-layout="left"] #previewPane {
                    display: none;
                }

                /* åªé è¦½ï¼šæ»¿é«˜ï¼Œç·¨è¼¯ä¸ä½”ç‰ˆé¢ */
                #workbench[data-layout="right"] {
                    grid-template-columns: 1fr;
                    grid-template-rows: 0 1fr;
                }
                #workbench[data-layout="right"] #editorPane {
                    display: none;
                }
            }

            /* å…±ç”¨ï¼šæœªé¸å– */
            .mode-btn {
                background: #f7f9fc;
                color: #8a5200; /* ä½ ç¾åœ¨é‚£ç¨®ç¥ç€å­—è‰² */
                border: 1px solid #d5deff;
            }

            /* å¥—çµ„ Aï¼šæ·±è—åº• + ç™½å­—ï¼ˆå°æ¯”æœ€é«˜ï¼‰ */
            .mode-btn[aria-pressed="true"].theme-blue {
                background: #3b5bdb; /* æ·±è— */
                color: #ffffff;
                border-color: #3b5bdb;
            }

            /* å¥—çµ„ Bï¼šç¥ç€æ·ºåº• + æ·±å­—ï¼ˆæš–è‰²ç³»ä½†ä»æœ‰å°æ¯”ï¼‰ */
            .mode-btn[aria-pressed="true"].theme-amber {
                background: #fff1cc; /* å¾ˆæ·ºçš„ç¥ç€ */
                color: #7a3e00; /* æ¯”æœªé¸å–å†æ·±ä¸€éš */
                border-color: #e6b980;
            }

            /* å¥—çµ„ Cï¼šçŸ³å¢¨ç°åº• + ç™½å­—ï¼ˆä¸­æ€§ï¼‰ */
            .mode-btn[aria-pressed="true"].theme-gray {
                background: #4a4a4a;
                color: #ffffff;
                border-color: #4a4a4a;
            }

            /* å¯é¸ï¼šhover æç¤ºï¼Œä¹Ÿåˆ¥è®“å­—è‰²æ¶ˆå¤± */
            .mode-btn:hover {
                filter: brightness(0.97);
            }
        </style>
    </head>
    <body>
        <header>
            <div class="title">MD 2 Html</div>
            <div class="actions">
                <div class="theme-wrap" title="èª¿æ•´æ¸²æŸ“å¾Œçš„å­—é«”èˆ‡è¡¨æ ¼ç·šæ¢è‰²">
                    <select id="themeSelect" aria-label="é¸æ“‡å¤–è§€ä¸»é¡Œ">
                        <option value="default">åŸé¢¨æ ¼</option>
                        <option value="milktea">å¥¶èŒ¶</option>
                        <option value="navy">æ²‰ç©©è—</option>
                        <option value="forest">æ£®æ—</option>
                        <option value="rose">ç²‰ç´…ç«ç‘°</option>
                        <option value="peach">æ©˜é»ƒ</option>
                        <option value="mint">è—ç¶ </option>
                        <option value="apple">é’è˜‹æœ</option>
                    </select>
                </div>
                <div class="view-toggle" role="group" aria-label="æª¢è¦–æ¨¡å¼">
                    <button class="mode-btn theme-amber" data-layout="split" aria-pressed="true">ä¸¦æ’</button>
                    <button class="mode-btn theme-amber" data-layout="left" aria-pressed="false">åªç·¨è¼¯</button>
                    <button class="mode-btn theme-amber" data-layout="right" aria-pressed="false">åªé è¦½</button>
                </div>
                <button class="btn secondary" onclick="location.href='index.html'">ğŸ§­å›é¦–é </button>
            </div>
        </header>

        <div class="wrap">
            <div id="workbench" data-layout="split">
                <section id="editorPane" class="panel">
                    <h3>
                        âœï¸ ç·¨è¼¯
                        <button class="btn secondary" onclick="clearMarkdown()">æ¸…ç©º</button>
                        <button class="btn secondary" onclick="document.getElementById('openMd').click()">é–‹å•ŸMD</button>
                        <input id="openMd" type="file" accept=".md,.markdown,text/markdown,text/plain" style="display: none;" />
                        <button class="btn secondary" onclick="copyMarkdown()">è¤‡è£½MD</button>
                        <button class="btn" id="saveMdBtn">å„²å­˜MD</button>
                    </h3>
                    <div class="body">
                        <textarea id="markdown-input">
# æ¸¬è©¦æ–‡ä»¶-å¤§æ¨™é¡Œ
## ä¸­æ¨™é¡Œ
### å°æ¨™é¡Œ

ç²—é«”å­— **Markdown**

æ–œé«”å­— *Markdown*

~~åˆªé™¤ç·š~~

---
é€™å€‹æ˜¯ç·šæ¢

> é€™æ˜¯å¼•è¨€
 
éšå±¤ç”¨ã€Œ*æˆ–-ã€éƒ½å¯ä»¥

- éšå±¤ä¸€
  - éšå±¤äºŒ
    - éšå±¤ä¸‰

1. åºè™Ÿéšå±¤1
2. åºè™Ÿéšå±¤2
3. åºè™Ÿéšå±¤3

ç¨‹å¼ç¢¼ `code ~ hello world!`

å€å¡Šç¨‹å¼ç¢¼ 
```
code ~ hello world ! 
test1
test 2
```


| é …ç›® | èªªæ˜ |
| ---- | ---- |
| èˆªå¸ | é•·æ¦® |
| ç›®çš„åœ° | å³‡é‡Œå³¶ |
| ä½å®¿ | Hilton, Intercontinental Jimbaran, W, Grand Hyatt |
           

![åœ–ç‰‡1](logo.png)
![åœ–ç‰‡1](logo.png)
![åœ–ç‰‡1](logo.png)


                        </textarea>
                    </div>
                </section>

                <section id="previewPane" class="panel">
                    <h3>
                        ğŸ–¼ï¸ é è¦½
                        <button class="btn secondary" id="btn-copy" onclick="copyOutputHTML()">è¤‡è£½HTML</button>
                        <button class="btn" onclick="triggerDownload()">ä¸‹è¼‰HTML</button>
                    </h3>
                    <div class="body"><div id="preview" class="preview-box"></div></div>
                </section>
            </div>
        </div>
        <div id="toast" class="toast"></div>

        <div id="lightbox" class="lightbox" aria-hidden="true">
            <button class="lb-close" aria-label="Close" onclick="closeLightbox()">âœ•</button>
            <img id="lightbox-img" alt="" />
        </div>

        <script>
            "use strict";

            // ====== å®‰å…¨ï¼šè‹¥ CDN å¤±æ•—ï¼Œç”¨ fallback è§£æ Markdown ======

            function escapeHtml(str) {
                return str.replace(/[&<>"]/g, (s) => ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[s]));
            }

            function mdFallback(md) {
                // ç¨‹å¼ç¢¼å€å¡Š ``` ... ```
                md = md.replace(/```([\s\S]*?)```/g, (_, code) => "<pre><code>" + escapeHtml(code) + "</code></pre>");

                // æ¨™é¡Œ
                md = md.replace(/^###\s+(.*)$/gm, "<h3>$1</h3>");
                md = md.replace(/^##\s+(.*)$/gm, "<h2>$1</h2>");
                md = md.replace(/^#\s+(.*)$/gm, "<h1>$1</h1>");

                // åœ–ç‰‡èˆ‡é€£çµ
                md = md.replace(/!\[([^\]]*)\]\(([^)]+)\)/g, '<p><img alt="$1" src="$2"></p>');
                md = md.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');

                // å¼·èª¿ã€è¡Œå…§ç¨‹å¼
                md = md.replace(/\*\*([^*]+)\*\*/g, "<strong>$1</strong>");
                md = md.replace(/\*([^*]+)\*/g, "<em>$1</em>");
                md = md.replace(/`([^`]+)`/g, "<code>$1</code>");

                // è¡¨æ ¼ï¼ˆæœ€é™½æ˜¥ç‰ˆï¼‰
                md = md.replace(/(?:^|\n)(\|.*\|)\n(\|[\-:\s\|]+\|)\n((?:\|.*\|\n?)*)/g, function (_, header, sep, body) {
                    function rowToCells(r) {
                        return r
                            .trim()
                            .slice(1, -1)
                            .split("|")
                            .map((s) => s.trim());
                    }
                    const headTds = rowToCells(header)
                        .map((h) => "<th>" + escapeHtml(h) + "</th>")
                        .join("");
                    const bodyHtml = body
                        .trim()
                        .split(/\n/)
                        .filter(Boolean)
                        .map(
                            (r) =>
                                "<tr>" +
                                rowToCells(r)
                                    .map((c) => "<td>" + escapeHtml(c) + "</td>")
                                    .join("") +
                                "</tr>"
                        )
                        .join("");
                    return "\n<table><thead><tr>" + headTds + "</tr></thead><tbody>" + bodyHtml + "</tbody></table>\n";
                });

                // æ®µè½
                md = md.replace(/(^|\n)([^<\n][^\n]*)/g, function (_, br, line) {
                    if (/^\s*$/.test(line)) return br + line;
                    if (/^\s*<(h\d|pre|table|blockquote|ul|ol|img)/i.test(line)) return br + line;
                    return br + "<p>" + line.trim() + "</p>";
                });
                return md;
            }

            function renderMarkdown(md) {
                if (window.marked && typeof marked.parse === "function") return marked.parse(md);
                return mdFallback(md);
            }

            // ====== Header å°ºå¯¸è®Šæ•¸ ======
            function setHeaderHeightVar() {
                const h = document.querySelector("header")?.offsetHeight || 60;
                document.documentElement.style.setProperty("--header-h", h + "px");
            }
            window.addEventListener("load", setHeaderHeightVar);
            window.addEventListener("resize", setHeaderHeightVar);

            // ====== ä¸»é¡Œï¼šåˆå§‹åŒ–èˆ‡åˆ‡æ› ======
            const THEME_KEY = "md2html_theme";
            function applyTheme(theme) {
                const root = document.documentElement;
                if (!theme || theme === "default") root.removeAttribute("data-theme");
                else root.setAttribute("data-theme", theme);
                const sel = document.getElementById("themeSelect");
                if (sel && sel.value !== theme) sel.value = theme || "default";
            }
            function initTheme() {
                const saved = localStorage.getItem(THEME_KEY) || "default";
                applyTheme(saved);
                const sel = document.getElementById("themeSelect");
                sel.value = saved;
                sel.addEventListener("change", () => {
                    const v = sel.value;
                    localStorage.setItem(THEME_KEY, v);
                    applyTheme(v);
                });
            }

            // ====== Callout é è™•ç† ======
            function preprocessCallouts(md) {
                const lines = md.split(/\\r?\\n/);
                const out = [];
                const defaultTitle = { NOTE: "Note", TIP: "Tip", WARNING: "Warning", INFO: "Info" };
                let i = 0;
                while (i < lines.length) {
                    const m = lines[i].match(/^\\s*>\\s*\\[\\!(NOTE|TIP|WARNING|INFO)\\]\\s*(.*)$/i);
                    if (m) {
                        const kind = m[1].toUpperCase();
                        const titleText = m[2] && m[2].trim() ? m[2].trim() : defaultTitle[kind];
                        const body = [];
                        i += 1;
                        while (i < lines.length) {
                            const l = lines[i];
                            if (/^\\s*>/.test(l)) {
                                body.push(l.replace(/^\\s*>\\s?/, ""));
                                i += 1;
                            } else if (/^\\s*$/.test(l)) {
                                body.push("");
                                i += 1;
                            } else {
                                break;
                            }
                        }
                        const bodyMd = body.join("\\n");
                        const head = '<div class="callout-head"><strong>' + titleText + "</strong></div>";
                        const bodyHtml = renderMarkdown(bodyMd);
                        out.push('<blockquote class="callout">' + head + '<div class="callout-body">' + bodyHtml + "</div></blockquote>");
                        continue;
                    }
                    out.push(lines[i]);
                    i += 1;
                }
                return out.join("\\n");
            }

            // ====== é€£çºŒåœ–ç‰‡åˆä½µå€å¡Š ======
            function isImageOnlyParagraph(node) {
                if (!(node && node.nodeType === 1 && node.tagName === "P")) return false;
                const kids = Array.from(node.childNodes);
                if (kids.length === 0) return false;
                return kids.every((n) => (n.nodeType === 1 && n.tagName === "IMG") || (n.nodeType === 3 && !n.nodeValue.trim()));
            }
            function wrapConsecutiveImages(root) {
                const nodes = Array.from(root.childNodes);
                let run = [];
                function flush() {
                    if (!run.length) return;
                    const gallery = document.createElement("div");
                    gallery.className = "gallery-block";
                    const head = document.createElement("div");
                    head.className = "gallery-head";
                    head.textContent = "åœ–ç‰‡";
                    const grid = document.createElement("div");
                    grid.className = "gallery-grid";
                    gallery.appendChild(head);
                    gallery.appendChild(grid);
                    run.forEach((p) => {
                        Array.from(p.querySelectorAll("img")).forEach((img) => {
                            const item = document.createElement("div");
                            item.className = "gallery-item";
                            const a = document.createElement("a");
                            a.className = "gallery-link";
                            const src = img.getAttribute("src");
                            a.href = src;
                            a.target = "_blank";
                            const thumb = img.cloneNode(true);
                            thumb.classList.add("thumb");
                            a.appendChild(thumb);
                            item.appendChild(a);
                            if (img.alt) {
                                const cap = document.createElement("div");
                                cap.className = "caption";
                                cap.textContent = img.alt;
                                item.appendChild(cap);
                            }
                            grid.appendChild(item);
                        });
                    });
                    root.insertBefore(gallery, run[0]);
                    run.forEach((n) => root.removeChild(n));
                    run = [];
                }
                for (const node of nodes) {
                    if (isImageOnlyParagraph(node)) run.push(node);
                    else flush();
                }
                flush();
            }

            // ====== æ¸²æŸ“ ======
            const input = document.getElementById("markdown-input");
            const preview = document.getElementById("preview");
            function buildContentHTMLFromMarkdown(md) {
                const container = document.createElement("div");
                container.className = "preview-box";
                try {
                    container.innerHTML = renderMarkdown(preprocessCallouts(md));
                } catch (e) {
                    container.innerHTML = "<p style='color:#b91c1c'>è§£æéŒ¯èª¤ï¼š" + (e.message || e) + "</p><pre>" + escapeHtml(md) + "</pre>";
                    console.error(e);
                }
                wrapConsecutiveImages(container);
                return container.outerHTML;
            }
            function render() {
                preview.innerHTML = buildContentHTMLFromMarkdown(input.value);
            }

            // ====== Lightbox ======
            const lb = document.getElementById("lightbox");
            const lbImg = document.getElementById("lightbox-img");
            function openLightbox(src, alt) {
                lbImg.src = src;
                lbImg.alt = alt || "";
                lb.classList.add("show");
                lb.setAttribute("aria-hidden", "false");
            }
            function closeLightbox() {
                lb.classList.remove("show");
                lb.setAttribute("aria-hidden", "true");
                lbImg.src = "";
            }
            window.closeLightbox = closeLightbox;
            document.addEventListener("click", (e) => {
                const a = e.target.closest(".gallery-link");
                if (a) {
                    e.preventDefault();
                    openLightbox(a.href, a.querySelector("img")?.alt);
                }
                if (e.target === lb) closeLightbox();
            });
            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape") closeLightbox();
            });

            // ====== åŒ¯å‡ºï¼šå°‡ç›®å‰ä¸»é¡Œè®Šæ•¸å¸¶å…¥è¼¸å‡ºæª” ======
            function getOutputHTML() {
                const content = buildContentHTMLFromMarkdown(document.getElementById("markdown-input").value);

                // å–å¾—ç›®å‰ä¸»é¡Œï¼›default ä»£è¡¨ä¸è¦åŠ  data-theme
                const themeName = document.documentElement.getAttribute("data-theme") || "default";

                // 1) å…ˆä¿åº•ï¼šè‹¥ THEME_BLOCKS é‚„æ²’å»ºå¥½ï¼Œå°±ç›´æ¥åºåˆ—åŒ– #themes-css çš„å…§å®¹
                const themesStyleEl = document.getElementById("themes-css");
                const rawThemesText = themesStyleEl ? themesStyleEl.textContent : "";

                // 2) å¾å¿«å–æ‹¿ç‰‡æ®µ
                const baseRoot = (window.THEME_BLOCKS && window.THEME_BLOCKS.default) || ""; // åŸºåº• :root
                const themeBlock =
                    themeName === "default"
                        ? "" // default å°±ä¸åŠ  data-theme å€å¡Š
                        : (window.THEME_BLOCKS && window.THEME_BLOCKS[themeName]) || "";

                // 3) è‹¥æ“·å–å¤±æ•—ï¼ˆä¾‹å¦‚æ™‚é–“é»å¤ªæ—©ï¼‰ï¼Œé€€å›æ•´åŒ…åŸå§‹ style æ–‡å­—ï¼Œç¢ºä¿ä¸æœƒç©ºç™½
                const finalThemeCSS = baseRoot || themeBlock ? baseRoot + "\n" + themeBlock : rawThemesText;

                // 4) åªæœ‰åœ¨é default æ™‚æ‰åŠ  data-theme å±¬æ€§
                const htmlAttr = themeName === "default" ? "" : ` data-theme="${themeName}"`;

                // 5) ç”¨è®Šæ•¸å»åƒèƒŒæ™¯è‰²ï¼Œä¸è¦ç¡¬å¯«ç™½åº•
                return `<!DOCTYPE html>
<html lang="zh-Hant"${htmlAttr}>
<head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>è¼¸å‡ºæ–‡ä»¶</title>
<style>
${finalThemeCSS}
body{ font-family:ui-sans-serif,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","Noto Sans","Microsoft JhengHei",Arial,Helvetica,sans-serif; padding:2rem; line-height:1.6; color:var(--text); background:#fff; }
h1,h2,h3{ color:var(--text) }
a{ color:var(--link); text-decoration:none } a:hover{text-decoration:underline}
code{ background:#f3f4f6; padding:0 .35rem; border-radius:4px }
pre{ background:#f3f4f6; padding:12px; border-radius:8px; overflow:auto; border:1px solid var(--line) }
table{ width:100%; border-collapse:collapse; margin:1rem 0; font-size:.95rem }
th,td{ border:1px solid var(--line); padding:.6rem .75rem; vertical-align:top; text-align:left }
thead th{ background:var(--table-head-bg); font-weight:700 }
blockquote{ position:relative; margin:1rem 0; padding:12px 16px 12px 18px; border-left:4px solid var(--bq-border); background:var(--bq-bg); border-radius:8px }
blockquote::before{ content:"â€œ"; position:absolute; top:-6px; left:8px; font-size:40px; line-height:1; color:var(--bq-quote); pointer-events:none }
blockquote { white-space: pre-wrap; word-wrap: break-word; overflow-wrap: break-word; }

.gallery-block{ border:1px solid var(--line); border-radius:12px; padding:12px; background:#fff; margin:1rem 0; box-shadow:0 1px 0 rgba(0,0,0,.02) }
.gallery-head{ font-size:13px; color:var(--muted); font-weight:600; display:flex; align-items:center; gap:6px; margin-bottom:10px }
.gallery-head::before{ content:"ğŸ–¼ï¸" }
.gallery-grid{ display:grid; grid-template-columns: repeat(3, var(--thumb-w)); gap:12px; justify-content:start }
.gallery-item{ width:var(--thumb-w); height:var(--thumb-h); border:1px solid var(--line); border-radius:10px; overflow:hidden; background:#fff }
.gallery-link{ display:block; width:100%; height:100% }
.gallery-item img.thumb{ width:100%; height:100%; object-fit:cover; display:block }
@media (max-width:767px){ :root{ --thumb-w:100%; --thumb-h:220px } .gallery-grid{ grid-template-columns:1fr } }

.lightbox{ position:fixed; inset:0; background:rgba(0,0,0,.8); display:none; align-items:center; justify-content:center; z-index:2000 }
.lightbox.show{ display:flex }
.lightbox img{ max-width:95vw; max-height:90vh; border-radius:8px; box-shadow:0 10px 30px rgba(0,0,0,.35) }
.lb-close{ position:absolute; top:16px; right:16px; background:rgba(255,255,255,.9); border:0; padding:8px 10px; border-radius:8px; cursor:pointer; font-weight:700 }
</style>
</head>
<body>
${content}
<div id="lightbox" class="lightbox" aria-hidden="true"><button class="lb-close" onclick="closeLightbox()">âœ•</button><img id="lightbox-img" alt=""/></div>
<script>
(function(){
  const lb=document.getElementById('lightbox'); const img=document.getElementById('lightbox-img');
  function open(src, alt){ img.src=src; img.alt=alt||''; lb.classList.add('show'); lb.setAttribute('aria-hidden','false'); }
  function close(){ lb.classList.remove('show'); lb.setAttribute('aria-hidden','true'); img.src=''; }
  window.closeLightbox=close;
  document.addEventListener('click', function(e){
    const a=e.target.closest('.gallery-link');
    if(a){ e.preventDefault(); open(a.href, a.querySelector('img')?.alt); }
    if(e.target===lb) close();
  });
  document.addEventListener('keydown', function(e){ if(e.key==='Escape') close(); });
})();
<\/script>
</body>
</html>`;
            }

            // ====== æŒ‰éˆ•å‹•ä½œ ======
            function triggerDownload() {
                const html = getOutputHTML();
                const blob = new Blob([html], { type: "text/html" });
                const a = document.createElement("a");
                a.href = URL.createObjectURL(blob);
                a.download = "output.html";
                a.click();
            }
            async function copyOutputHTML() {
                const btn = document.getElementById("btn-copy");
                const html = getOutputHTML();
                try {
                    if (navigator.clipboard && window.isSecureContext) {
                        await navigator.clipboard.writeText(html);
                    } else {
                        const ta = document.createElement("textarea");
                        ta.value = html;
                        ta.style.position = "fixed";
                        ta.style.left = "-9999px";
                        document.body.appendChild(ta);
                        ta.focus();
                        ta.select();
                        document.execCommand("copy");
                        document.body.removeChild(ta);
                    }
                    showToast("HTML å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿");
                    btn.textContent = "å·²è¤‡è£½";
                    setTimeout(() => (btn.textContent = "è¤‡è£½ HTML"), 1500);
                } catch (e) {
                    showToast("è¤‡è£½å¤±æ•—");
                    console.error(e);
                }
            }
            function clearMarkdown() {
                const input = document.getElementById("markdown-input");
                input.value = "";
                render();
            }
            function copyMarkdown() {
                const ta = document.getElementById("markdown-input");
                try {
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(ta.value);
                    } else {
                        const helper = document.createElement("textarea");
                        helper.value = ta.value;
                        helper.style.position = "fixed";
                        helper.style.left = "-9999px";
                        document.body.appendChild(helper);
                        helper.focus();
                        helper.select();
                        document.execCommand("copy");
                        document.body.removeChild(helper);
                    }
                    showToast("Markdown å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿");
                } catch (e) {
                    showToast("è¤‡è£½ Markdown å¤±æ•—");
                    console.error(e);
                }
            }
            function showToast(msg) {
                const t = document.getElementById("toast");
                t.textContent = msg;
                t.classList.add("show");
                setTimeout(() => t.classList.remove("show"), 1600);
            }

            // ç¶å®šèˆ‡åˆå§‹åŒ–
            window.triggerDownload = triggerDownload;
            window.copyOutputHTML = copyOutputHTML;
            window.clearMarkdown = clearMarkdown;
            window.copyMarkdown = copyMarkdown;

            window.addEventListener("DOMContentLoaded", () => {
                try {
                    initTheme();
                    const input = document.getElementById("markdown-input");
                    if (input) {
                        input.addEventListener("input", render);
                        render();
                    }
                } catch (e) {
                    console.error("åˆå§‹åŒ–éŒ¯èª¤", e);
                }
            });

            document.getElementById("openMd").addEventListener("change", async (e) => {
                const f = e.target.files?.[0];
                if (!f) return;
                const text = await f.text();
                const ta = document.getElementById("markdown-input");
                ta.value = text;
                render();
                localStorage.setItem("md2html_current_doc", text);
                showToast("å·²è¼‰å…¥ " + f.name);
            });

            // å„²å­˜MD
            const saveBtn = document.getElementById("saveMdBtn");
            if (saveBtn && !saveBtn.dataset.bound) {
                saveBtn.addEventListener("click", () => saveMd());
                saveBtn.dataset.bound = "1";
            }

            let saving = false;

            function getMdText() {
                const ta = document.getElementById("markdown-input");
                if (!ta) {
                    throw new Error("æ‰¾ä¸åˆ° #markdown-input");
                }
                return ta.value;
            }

            function makeFileName(base = "note") {
                const iso = new Date().toISOString().replace(/[:.]/g, "-");
                return `${base}-${iso}.md`;
            }

            function isIOS() {
                return /iPad|iPhone|iPod/.test(navigator.userAgent) || (navigator.platform === "MacIntel" && navigator.maxTouchPoints > 1);
            }

            async function saveMd(filename = makeFileName("note")) {
                if (saving) return; // é‡å…¥é–
                saving = true;
                try {
                    const mdText = getMdText();
                    const blob = new Blob([mdText], { type: 'text/markdown;charset=utf-8' });
                    const file = new File([blob], filename, { type: "text/markdown" });

                    // æ¡Œé¢ Chromiumï¼šçœŸæ­£ã€Œå­˜å›æª”æ¡ˆã€
                    if ("showSaveFilePicker" in window && !isIOS()) {
                        const handle = await window.showSaveFilePicker({
                            suggestedName: filename,
                            types: [{ description: "Markdown", accept: { "text/markdown": [".md"] } }],
                        });
                        const writable = await handle.createWritable();
                        await writable.write(blob);
                        await writable.close();
                        return;
                    }

                    // iOS / Androidï¼šç”¨åˆ†äº«é¢æ¿ï¼ˆå«ã€Œå­˜å…¥æª”æ¡ˆã€ï¼‰
                    if (navigator.canShare && navigator.canShare({ files: [file] })) {
                        try {
                            await navigator.share({ files: [file], title: filename, text: "Markdown æª”" });
                            // é‡è¦ï¼šåœ¨ iOS ä¸Šå³ä¾¿ share æˆåŠŸæœ‰æ™‚ä¹Ÿæœƒ throw
                            // æˆ‘å€‘æŠŠå®ƒç•¶ã€Œå·²å˜—è©¦åˆ†äº«ã€å°±çµæŸï¼Œä¸å†è§¸ç™¼ä¸‹è¼‰å‚™æ´ï¼Œé¿å…é›™æª”
                            return;
                        } catch (err) {
                            if (isIOS()) {
                                // iOSï¼šä¸å‚™æ´ä¸‹è¼‰ï¼Œé¿å…é›™æª”ã€‚æœ€å¤šæé†’ä¸€ä¸‹ä½¿ç”¨è€…ã€‚
                                console.debug("iOS share è¢«å–æ¶ˆæˆ–æ€ªéŒ¯ï¼Œç•¥éå‚™æ´ä¸‹è¼‰ä»¥é¿å…é‡è¤‡æª”æ¡ˆã€‚", err);
                                return;
                            }
                            // å…¶ä»–å¹³å°æ‰è½åˆ°ä¸‹è¼‰å‚™æ´
                        }
                    }

                    // é€šç”¨å‚™æ´ï¼šä¸‹è¼‰ .mdï¼ˆPC å°±æ˜¯é€™æ¢ï¼‰
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement("a");
                    a.href = url;
                    a.download = filename; // ç›¡é‡ä¿ä½ .md
                    document.body.appendChild(a);
                    a.click();
                    a.remove();
                    URL.revokeObjectURL(url);
                } catch (e) {
                    console.error(e);
                    alert("å„²å­˜å¤±æ•—ï¼š" + (e.message || e));
                } finally {
                    saving = false;
                }
            }
        </script>
        <script>
            // ç›¡é‡åªæƒæ”¾ä¸»é¡Œçš„é‚£ä»½æ¨£å¼ï¼Œé¿å…æ’ˆåˆ°åˆ¥çš„æ±è¥¿
            function getThemeStyleSheet() {
                for (const sheet of Array.from(document.styleSheets)) {
                    try {
                        // å¦‚æœç”¨ <style id="themes-css">ï¼Œç”¨ ownerNode å¿«é€Ÿé–å®š
                        if (sheet.ownerNode && sheet.ownerNode.id === "themes-css") return sheet;
                        // æˆ–è€…å¦‚æœç”¨åŒæºçš„ themes.cssï¼Œä¹Ÿå¯ä»¥ç”¨ href åˆ¤æ–·
                        if (sheet.href && sheet.href.endsWith("themes.css")) return sheet;
                    } catch (e) {
                        // éåŒæºæœƒä¸Ÿ SecurityErrorï¼Œç•¥é
                    }
                }
                return null;
            }

            function extractThemeBlocksFromSheet(sheet) {
                const themes = {};
                if (!sheet) return themes;

                function pushBlock(name, rule, wrapper) {
                    const cssText = `${wrapper}${rule.selectorText} { ${rule.style.cssText} }${wrapper ? " }" : ""}`;
                    if (!themes[name]) themes[name] = [];
                    themes[name].push(cssText);
                }

                function walk(rules, wrapper = "") {
                    for (const rule of Array.from(rules || [])) {
                        if (rule.type === CSSRule.STYLE_RULE && rule.selectorText) {
                            // 1) æŠ“è£¸ :root ç•¶ default
                            if (rule.selectorText.trim() === ":root") {
                                pushBlock("default", rule, wrapper);
                            }
                            // 2) æŠ“ :root[data-theme="xxx"]
                            const m = rule.selectorText.match(/^:root\[data-theme="([^"]+)"\]$/);
                            if (m) {
                                pushBlock(m[1], rule, wrapper);
                            }
                        }
                        if (rule.type === CSSRule.MEDIA_RULE) {
                            walk(rule.cssRules, `@media ${rule.media.mediaText} { `);
                        }
                    }
                }

                try {
                    walk(sheet.cssRules);
                } catch (_) {}

                // åˆä½µåŒåç‰‡æ®µ
                const out = {};
                for (const [k, arr] of Object.entries(themes)) out[k] = arr.join("\n");
                return out;
            }

            // åœ¨é é¢è¼‰å…¥å¾Œåšä¸€æ¬¡å¿«å–
            let THEME_BLOCKS = {};
            document.addEventListener("DOMContentLoaded", () => {
                const sheet = getThemeStyleSheet();
                THEME_BLOCKS = extractThemeBlocksFromSheet(sheet);
            });

            (function () {
                const root = document.getElementById("workbench");
                const group = document.querySelector(".view-toggle");
                const STORAGE_KEY = "mdtool_layout";

                function setLayout(mode) {
                    if (!root) return;
                    if (!["split", "left", "right"].includes(mode)) mode = "split";
                    root.setAttribute("data-layout", mode);
                    // æ›´æ–°æŒ‰éˆ• pressed ç‹€æ…‹
                    group?.querySelectorAll("button[data-layout]").forEach((btn) => {
                        btn.setAttribute("aria-pressed", btn.getAttribute("data-layout") === mode ? "true" : "false");
                    });
                    // è¨˜ä½ä½¿ç”¨è€…é¸æ“‡
                    try {
                        localStorage.setItem(STORAGE_KEY, mode);
                    } catch (e) {}
                }

                // äº‹ä»¶ç¶å®šï¼šä¸€å¾‹é»æŒ‰éˆ•åˆ‡æ¨¡å¼
                group?.addEventListener("click", (e) => {
                    const btn = e.target.closest("button[data-layout]");
                    if (!btn) return;
                    setLayout(btn.getAttribute("data-layout"));
                });

                // é‚„åŸä¸Šæ¬¡æ¨¡å¼ï¼Œæ²’æœ‰å°±ç”¨ split
                const saved = (() => {
                    try {
                        return localStorage.getItem(STORAGE_KEY);
                    } catch (e) {
                        return null;
                    }
                })();
                setLayout(saved || "split");
            })();
        </script>
    </body>
</html>
